<div class="map-wrapper">
  <div #mapContainer class="map-container"></div>
  <div #scaleContainer class="scale-container"></div>

  <!-- Planet selection -->
  <div class="planet-buttons">
    <button *ngFor="let planet of planets" (click)="setPlanet(planet)">
      {{ planet | titlecase }}
    </button>
  </div>

  <!-- Overlay Layers Panel -->
  <div class="overlay-panel" cdkDropList (cdkDropListDropped)="mapService.reorderLayers($event)">
    <div *ngIf="visibleLayers().length === 0" class="empty-hint">
      No layers available
    </div>
    <div *ngIf="visibleLayers().length > 0" class="drag-hint">
      Drag to reorder
    </div>

    <label *ngFor="let layer of visibleLayers(); let i = index" class="overlay-item" cdkDrag>
      <input type="checkbox" [checked]="layer.visible" (change)="toggleLayer(layer)">
      {{ layer.name }}
      <div class="drag-placeholder" *cdkDragPlaceholder></div>
    </label>
  </div>

  <!-- Add Layer Button -->
  <button class="add-layer-btn" (click)="openAddLayerModal()">
    <span class="plus-icon">+</span> Add Layer
  </button>

  <!-- Loading Overlay -->
  <div *ngIf="mapService.isLoading()" class="loading-overlay">
    Loading...
  </div>

  <!-- Modal for adding layers -->
  <div *ngIf="isModalOpen()" class="modal-backdrop">
    <div class="modal-content">
      <button class="close-btn" (click)="cancelModal()">Ã—</button>

      <h3>Add Layer</h3>

      <label>Name: <input type="text" [(ngModel)]="newLayer().name"></label>
      <label>Type:
        <select [(ngModel)]="newLayer().type">
          <option value="vector">Vector</option>
          <option value="raster">Raster</option>
          <option value="overlay">Overlay</option>
        </select>
      </label>
      <label>Source URL: <input type="text" [(ngModel)]="newLayer().source"></label>
      <label>Color: <input type="color" [(ngModel)]="newLayer().color"></label>
      <label>Visible: <input type="checkbox" [(ngModel)]="newLayer().visible"></label>

      <div class="modal-actions">
        <button (click)="cancelModal()">Cancel</button>
        <button (click)="submitLayerModal()">OK</button>
      </div>
    </div>
  </div>

  <!-- Terminal -->
  <div class="terminal">
    <input #terminalInput type="text" (keydown.enter)="handleTerminalCommand($event)">
    <div *ngFor="let line of mapService.terminalLines()">
      {{ line }}
    </div>
  </div>
</div>
