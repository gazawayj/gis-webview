<div class="page">
  <aside class="sidebar">
    <h1>GIS Web Viewer</h1>

    <div class="planet-buttons">
      <button (click)="setPlanet('earth')" [class.active]="currentPlanet==='earth'">Earth</button>
      <button (click)="setPlanet('moon')" [class.active]="currentPlanet==='moon'">Moon</button>
      <button (click)="setPlanet('mars')" [class.active]="currentPlanet==='mars'">Mars</button>
    </div>

    <div class="overlay-panel" cdkDropList (cdkDropListDropped)="onLayerDropped($event)">
      <div *ngIf="layers.length === 0" class="empty-hint">
        No layers available for this planet.
      </div>

      <!-- Layers list container (reversed) -->
      <div class="layers-list">
        <label *ngFor="let layer of layers; let i = index" class="overlay-item" cdkDrag>
          <span class="drag-handle">⠿</span>
          <span class="layer-number">{{ i + 1 }}</span>

          <input type="checkbox" [checked]="layer.visible" (change)="toggleLayer(layer)" />

          <div class="layer-info">
            <strong>{{ layer.name }}</strong>
            <span class="hint">{{ layer.description }}</span>
          </div>

          <div class="drag-placeholder" *cdkDragPlaceholder></div>
        </label>
      </div>

      <!-- Keep Add Layer button at bottom -->
      <div class="layer-actions">
        <button class="add-layer-btn" (click)="onAddLayer()">
          <span class="plus-icon">+</span> Add Layer
        </button>
      </div>
    </div>

    <div class="stats-panel">
      <div class="stat-item">
        <span>Zoom Level</span>
        <strong>{{ zoomDisplay }}</strong>
      </div>

      <div class="coords-display-lon">
        <span>{{ currentStats.lonLabel }}</span>
        <strong>{{ formatCoord(currentLon, 'lon') }}</strong>
      </div>

      <div class="coords-display-lat">
        <span>{{ currentStats.latLabel }}</span>
        <strong>{{ formatCoord(currentLat, 'lat') }}</strong>
      </div>

      <div class="stat-item">
        <span>Surface Gravity</span>
        <strong>{{ currentStats.gravity }}</strong>
      </div>
    </div>
  </aside>

  <main class="map-wrapper">
    <div #mapContainer class="map-container"></div>

    <div *ngIf="isLoading" class="loading-overlay">
      <div class="loading-card">
        <div class="spinner"></div>
        <span>Loading Map Data...</span>
      </div>
    </div>
  </main>
</div>

<div *ngIf="isModalOpen" class="modal-backdrop">
  <div class="modal fade-in">

    <div class="modal-header toolbar">
      <h2>Input Options</h2>
      <button class="close-btn" (click)="closeModal()">×</button>
    </div>

    <div class="modal-tabs">
      <button [class.active]="modalMode==='manual'" (click)="modalMode='manual'">Manual</button>
      <button [class.active]="modalMode==='console'" (click)="modalMode='console'">Console</button>
    </div>

    <div class="modal-content">

      <div class="manual-wrapper" [class.active]="modalMode==='manual'">
        <form class="manual-form">
          <div class="form-row">
            <label>
              Layer Name:
              <input [(ngModel)]="newLayer.name" name="layerName">
            </label>

            <label>
              Layer Type:
              <select [(ngModel)]="newLayer.type" name="layerType">
                <option value="vector">Vector</option>
                <option value="raster">Raster</option>
              </select>
            </label>
          </div>

          <div class="form-row">
            <label>
              URL:
              <input [(ngModel)]="newLayer.source" name="layerSource">
            </label>
          </div>

          <div class="form-row">
            <label>
              Color:
              <input type="color" [(ngModel)]="newLayer.color" name="layerColor">
            </label>

            <label>
              Visible:
              <input type="checkbox" [(ngModel)]="newLayer.visible" name="layerVisible">
            </label>
          </div>
        </form>
      </div>

      <div class="console-wrapper" [class.active]="modalMode==='console'">
        <div class="console-input">
          <div *ngFor="let line of terminalLines">{{ line }}</div>
          <div class="terminal-input-row">
            <span class="terminal-prompt">></span>
            <input type="text" class="manual-input" (keydown.enter)="handleTerminalCommand($event)">
          </div>
        </div>
      </div>

    </div>

    <div class="modal-footer">
      <button class="cancel-btn" (click)="closeModal()">Cancel</button>
      <button class="ok-btn" (click)="modalMode==='manual'?createManualLayer():null">OK</button>
    </div>

  </div>
</div>