<div class="page">
  <aside class="sidebar">
    <h1>GIS Web Viewer</h1>

    <!-- Planet Buttons -->
    <div class="planet-buttons">
      <button (click)="setPlanet('earth')" [class.active]="currentPlanet==='earth'">Earth</button>
      <button (click)="setPlanet('moon')" [class.active]="currentPlanet==='moon'">Moon</button>
      <button (click)="setPlanet('mars')" [class.active]="currentPlanet==='mars'">Mars</button>
    </div>

    <!-- Layer List -->
    <div class="overlay-panel" cdkDropList (cdkDropListDropped)="onLayerDropped($event)">
      <div *ngIf="layers.length === 0" class="empty-hint">No layers available for this planet.</div>

      <div class="layers-list">
        <label *ngFor="let layer of layers; let i = index" class="overlay-item" cdkDrag>
          <span class="drag-handle">⠿</span>
          <span class="layer-number">{{ i + 1 }}</span>

          <input type="checkbox" [checked]="layer.visible" (change)="toggleLayer(layer)" />

          <div class="layer-info">
            <strong>{{ layer.name }}</strong>
            <span class="hint">{{ layer.description }}</span>
          </div>

          <div class="layer-controls">
            <input type="color" [(ngModel)]="layer.color" (change)="updateLayerStyle(layer)" title="Layer Color" />
            <div class="shape-dropdown-wrapper">
              <div class="shape-selected" (click)="toggleShapeDropdown(layer)">
                <svg width="20" height="20" viewBox="0 0 20 20">
                  <ng-container [ngSwitch]="layer.shape">
                    <circle *ngSwitchCase="'circle'" cx="10" cy="10" r="8" [attr.fill]="layer.color"></circle>
                    <rect *ngSwitchCase="'square'" x="3" y="3" width="14" height="14" [attr.fill]="layer.color"></rect>
                    <polygon *ngSwitchCase="'triangle'" points="10,2 18,18 2,18" [attr.fill]="layer.color"></polygon>
                    <polygon *ngSwitchCase="'diamond'" points="10,2 18,10 10,18 2,10" [attr.fill]="layer.color"></polygon>
                    <polygon *ngSwitchCase="'pentagon'" points="10,2 18,8 15,18 5,18 2,8" [attr.fill]="layer.color"></polygon>
                    <polygon *ngSwitchCase="'hexagon'" points="5,2 15,2 18,10 15,18 5,18 2,10" [attr.fill]="layer.color"></polygon>
                    <polygon *ngSwitchCase="'star'" points="10,2 12,8 18,8 13,12 15,18 10,14 5,18 7,12 2,8 8,8" [attr.fill]="layer.color"></polygon>
                    <circle *ngSwitchDefault cx="10" cy="10" r="8" [attr.fill]="layer.color"></circle>
                  </ng-container>
                </svg>
              </div>

              <ul class="shape-options" *ngIf="layer.isDropdownOpen">
                <li *ngFor="let s of availableShapes" (click)="selectShape(layer, s)">
                  <svg width="20" height="20" viewBox="0 0 20 20">
                    <ng-container [ngSwitch]="s">
                      <circle *ngSwitchCase="'circle'" cx="10" cy="10" r="8" [attr.fill]="layer.color"></circle>
                      <rect *ngSwitchCase="'square'" x="3" y="3" width="14" height="14" [attr.fill]="layer.color"></rect>
                      <polygon *ngSwitchCase="'triangle'" points="10,2 18,18 2,18" [attr.fill]="layer.color"></polygon>
                      <polygon *ngSwitchCase="'diamond'" points="10,2 18,10 10,18 2,10" [attr.fill]="layer.color"></polygon>
                      <polygon *ngSwitchCase="'pentagon'" points="10,2 18,8 15,18 5,18 2,8" [attr.fill]="layer.color"></polygon>
                      <polygon *ngSwitchCase="'hexagon'" points="5,2 15,2 18,10 15,18 5,18 2,10" [attr.fill]="layer.color"></polygon>
                      <polygon *ngSwitchCase="'star'" points="10,2 12,8 18,8 13,12 15,18 10,14 5,18 7,12 2,8 8,8" [attr.fill]="layer.color"></polygon>
                    </ng-container>
                  </svg>
                </li>
              </ul>
            </div>

            <button class="remove-layer-btn" (click)="removeLayer(layer)" title="Remove Layer">×</button>
          </div>

          <div class="drag-placeholder" *cdkDragPlaceholder></div>
        </label>
      </div>

      <div class="layer-actions">
        <button class="add-layer-btn" (click)="onAddLayer()">
          <span class="plus-icon">+</span> Add Layer
        </button>
      </div>
    </div>

    <!-- Stats Panel -->
    <div class="stats-panel" *ngIf="map">
      <div class="stat-item"><strong>Zoom:</strong> {{ zoomDisplay | number:'1.1-2' }}</div>
      <div class="stat-item"><strong>Lon:</strong> {{ currentLon | number:'1.4-4' }}</div>
      <div class="stat-item"><strong>Lat:</strong> {{ currentLat | number:'1.4-4' }}</div>
    </div>
  </aside>

  <!-- Map -->
  <div class="map-wrapper">
    <div #mapContainer class="map-container"></div>

    <div class="spinner-overlay" *ngIf="isLoading">
      <div class="spinner"></div>
      <div class="spinner-message">{{ loadingMessage }}</div>
    </div>
  </div>
</div>
