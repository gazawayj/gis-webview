<div class="page">
  <!-- Sidebar -->
  <aside class="sidebar">

    <!-- Top section: header + planet buttons + add-layer button -->
    <div class="sidebar-top">
      <h1>GIS Web Viewer</h1>

      <div class="planet-buttons">
        <button (click)="setPlanet('earth')" [class.active]="currentPlanet==='earth'">Earth</button>
        <button (click)="setPlanet('moon')" [class.active]="currentPlanet==='moon'">Moon</button>
        <button (click)="setPlanet('mars')" [class.active]="currentPlanet==='mars'">Mars</button>
      </div>

      <!-- Add Layer button on the right -->
      <div class="add-layer">
        <button (click)="onAddLayer()">+ Add Layer</button>
      </div>
    </div>

    <!-- Layer list: scrollable -->
    <div class="layer-list" cdkDropList [cdkDropListData]="layers" (cdkDropListDropped)="onLayerDropped($event)">
      <app-layer-item *ngFor="let layer of layers; let i = index" [layer]="layer"
        (visibilityChange)="toggleLayer(layer)" (colorChange)="onColorPicked(layer, $event)"
        (shapeChange)="selectShape(layer, $event)" (remove)="removeLayer(layer)" cdkDrag>
      </app-layer-item>
      <div *ngIf="layers.length === 0" class="no-layers-tooltip">
        No layers in the list yet, use 'Add Layer' above.
      </div>
    </div>

    <!-- Stats panel: fixed at bottom -->
    <div class="map-stats">
      <div class="stat-item">
        <span class="stat-label">Zoom:</span>
        <span class="stat-value">{{ zoomDisplay }}</span>
      </div>
      <div class="stat-item">
        <span class="stat-label">{{ lonLabel }}:</span>
        <span class="stat-value">{{ formattedLon }}</span>
      </div>
      <div class="stat-item">
        <span class="stat-label">{{ latLabel }}:</span>
        <span class="stat-value">{{ formattedLat }}</span>
      </div>
    </div>
  </aside>

  <!-- Main map area -->
  <main class="map-main">
    <!-- Map container -->
    <div #mapContainer class="map-container"></div>

    <!-- Global spinner overlay -->
    <div class="spinner-overlay" *ngIf="isLoading">
      <div class="spinner-content">
        <div class="spinner-icon"></div>
        <div class="spinner-message">{{ loadingMessage }}</div>
      </div>
    </div>
  </main>

  <!-- Add Layer Modal -->
  <div class="modal" *ngIf="showAddLayerModal">
    <div class="modal-content">
      <h2>Add New Layer</h2>
      <label>
        Name:
        <input type="text" [(ngModel)]="newLayerName" />
      </label>
      <label>
        Description:
        <input type="text" [(ngModel)]="newLayerDescription" />
      </label>
      <div class="modal-actions">
        <button (click)="confirmAddLayer()">Add</button>
        <button (click)="cancelAddLayer()">Cancel</button>
      </div>
    </div>
  </div>
</div>