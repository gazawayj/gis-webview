<div class="page">
  <!-- Sidebar -->
  <aside class="sidebar">
    <h1>GIS Web Viewer</h1>

    <div class="planet-buttons">
      <button (click)="setPlanet('earth')" [class.active]="currentPlanet==='earth'">Earth</button>
      <button (click)="setPlanet('moon')" [class.active]="currentPlanet==='moon'">Moon</button>
      <button (click)="setPlanet('mars')" [class.active]="currentPlanet==='mars'">Mars</button>
    </div>

    <!-- Layers Container -->
    <div class="overlay-panel" cdkDropList (cdkDropListDropped)="onLayerDropped($event)"
      [style.counter-reset]="'layer-counter ' + (layers.length + 1)">
      <div *ngIf="layers.length === 0" class="empty-hint">No layers available for this planet.</div>
      <div *ngIf="layers.length > 0" class="drag-hint">Click and drag layers to reorder stack</div>

      <div class="layer-actions">
        <button class="add-layer-btn" (click)="openModal('manual')">
          <span class="plus-icon">+</span> Add Layer
        </button>
      </div>

      <div style="flex:1"></div>

      <label *ngFor="let layer of layers; let i=index" class="overlay-item" cdkDrag>
        <span class="drag-handle">⠿</span>
        <span class="layer-number live-rank"></span>
        <input type="checkbox" [checked]="layer.visible" (change)="toggleLayer(layer)">
        <div class="layer-info">
          <strong>{{layer.name}}</strong>
          <span class="hint">{{layer.description}}</span>
        </div>
        <div class="drag-placeholder" *cdkDragPlaceholder></div>
      </label>
    </div>

    <!-- Stats -->
    <div class="stats-panel">
      <div class="stat-item">
        <span>Zoom Level</span>
        <strong>{{zoomDisplay}}</strong>
      </div>
      <div class="coords-display-lon">
        <span>{{currentStats.lonLabel}}</span>
        <strong>{{currentLon}}</strong>
      </div>
      <div class="coords-display-lat">
        <span>{{currentStats.latLabel}}</span>
        <strong>{{currentLat}}</strong>
      </div>
      <div class="stat-item">
        <span>Surface Gravity</span>
        <strong>{{currentStats.gravity}}</strong>
      </div>
    </div>
  </aside>

  <!-- Map -->
  <main class="map-wrapper">
    <div #mapContainer id="mapContainer" class="map-container"></div>
    <div *ngIf="isLoading" class="loading-overlay">
      <div class="loading-card">
        <div class="spinner"></div>
        <span>Loading Map Data...</span>
      </div>
    </div>
  </main>
</div>

<!-- Modal -->
<div *ngIf="isModalOpen" class="layer-modal">
  <div class="modal-content">
    <!-- Close Button -->
    <button class="modal-close" (click)="closeModal()">×</button>

    <!-- Left Side: Tabs & Inputs -->
    <div class="modal-left">
      <!-- Tabs -->
      <div class="tabs">
        <button [class.active]="activeTab === 'console'" (click)="activeTab='console'">Console</button>
        <button [class.active]="activeTab === 'manual'" (click)="activeTab='manual'">Manual</button>
      </div>

      <!-- Tab Contents -->
      <div *ngIf="activeTab === 'console'" class="terminal-container">
        <textarea class="console-input" placeholder="Enter commands here..." [(ngModel)]="consoleValue"></textarea>
      </div>
      <div *ngIf="activeTab === 'manual'" class="manual-form">
        <textarea class="manual-input" placeholder="Enter manual input here..." [(ngModel)]="manualValue"></textarea>
      </div>
    </div>

    <!-- Right Side: Preview / Info -->
    <div class="modal-right">
      <p *ngIf="activeTab==='console'">Console mode allows you to type commands to control the GIS.</p>
      <p *ngIf="activeTab==='manual'">Manual input allows you to create a new layer with your parameters.</p>
    </div>

    <!-- Footer Buttons -->
    <div class="modal-buttons">
      <button class="cancel-btn" (click)="closeModal()">Cancel</button>
      <button class="ok-btn" (click)="submitModal()">OK</button>
    </div>
  </div>
</div>
